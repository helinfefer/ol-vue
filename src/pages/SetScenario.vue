
<template>
  <div class="scenario-container">
    <br>
  <!-- <h3>创建一个情景</h3> -->
  
  <el-form 
    ref="form" 
    :model="form" 
    label-width="150px" 
    class="scenario-form"
  >
  <el-row >

    <el-col :span="12">
      <!-- <el-form-item label="模型名称">
        <el-select v-model="form.modelName" placeholder="请选择">
          <el-option 
            v-for = "item in modelNames"
            :key="item.value"
            :label="item.label"
            :value="item.value"
          >
          </el-option>
        </el-select>
      </el-form-item> -->
      <el-form-item label="模型名称">
        <el-input v-model="form.modelName" placeholder="请输入模型名称"></el-input>
      </el-form-item>

      <el-form-item label="基础情景">
        <el-switch v-model="form.productionCalculation"></el-switch>
      </el-form-item>

      <!-- 基础数据合集的选择  -->
      <el-form-item label="基础数据合集:" >
        <el-select v-model="form.selectedCollection" placeholder="请选择">
          <el-option
            v-for="item in baseDataCollections"
            :key="item.id"
            :label="item.label"
            :value="item.name"
          ></el-option>
        </el-select>
      </el-form-item>

      <el-form-item label="住宅空置率">
        <el-input-number v-model="form.residentialVacancyRate" :min="0" :max="1" :step="0.01"></el-input-number>
      </el-form-item>
      
      <el-form-item label="家庭增长率">
        <hr/>
      </el-form-item>
      <el-form-item label="家庭增长率">
        <el-input-number v-model="form.householdGrowthRate" :min="0" :max="1" :step="0.01"></el-input-number>
      </el-form-item>
  
      <!-- 中间添加 "or" 文本 -->
      <el-form-item label="或"></el-form-item>
  
      <!-- 家庭总控制文件输入框 -->


    <el-form-item label="家庭控制总量:" >
      <el-upload
          class="upload-demo"
          action="http://localhost:5000/upload_data/householdControl"
          accept=".csv"
          :on-success="handleSuccess"
          :on-error="handleError"     
          >
          <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
      </el-upload>
      <el-select v-model="form.selectedHControl" placeholder="请选择">
        <el-option
          v-for="item in HControlsOptions"
          :key="item.uid"
          :label="item.label"
          :value="item.uid"
        ></el-option>
      </el-select>
    </el-form-item>
    
      <el-form-item label="就业增长率">
        <hr/>
      </el-form-item>
      <el-form-item label="就业增长率">
        <el-input-number v-model="form.employmentGrowthRate" :min="0" :max="1" :step="0.01"></el-input-number>
      </el-form-item>
    
      <!-- 中间添加 "or" 文本 -->
      <el-form-item label="或"></el-form-item>
    
      <!-- 就业总控制文件输入框 -->

      <el-form-item label="就业控制总量:">
        <el-upload
            class="upload-demo"
            action="http://localhost:5000/upload_data/employControl"
            multiple
            :limit="3"
            :file-list="fileList">
            <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
        </el-upload>
        <el-select v-model="form.selectedJobControl" placeholder="请选择">
          <el-option
            v-for="item in jobControlsOptions"
            :key="item.uid"
            :label="item.label"
            :value="item.uid"
          ></el-option>
        </el-select>
      </el-form-item>
    </el-col>
    <!-- 操作按钮 -->

    <el-col :span="12">
      <!-- 交通模型分区 -->
      <el-form-item label="交通模型分区">
        <el-select v-model="form.travelModelZone" placeholder="请选择">
          <el-option 
            v-for = "item in travelModelZones"
            :key="item.value"
            :label="item.label"
            :value="item.value"
          >
          </el-option>
          <!-- 这里可以继续添加更多的选项 -->
        </el-select>
      </el-form-item>

      <el-form-item label="交通模型阻抗skims">
        <el-upload
            class="upload-demo"
            action="http://localhost:5000/upload_data/skims"
            multiple
            :limit="3"
            :file-list="fileList">
            <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
        </el-upload>
      </el-form-item>

      <el-form-item label="交通模型网络">
        <el-upload
            class="upload-demo"
            action="http://localhost:5000/upload_data/travelNetworks"
            multiple
            :limit="3"
            :file-list="fileList">
            <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
        </el-upload>
      </el-form-item>

      <!-- 大文本区域 -->
      <el-form-item label="备注">
        <el-input type="textarea" v-model="form.notes"></el-input>
      </el-form-item>

        <!-- 开发标签选择器 -->
        <el-form-item label="Development Tags">
          <el-select v-model="form.developmentTags" placeholder="请选择">
            <!-- 这里添加选项 -->
          </el-select>
        </el-form-item>
        <!-- 约束标签选择器 -->
        <el-form-item label="Constraint Tags">
          <el-select v-model="form.constraintTags" placeholder="请选择">
            <!-- 这里添加选项 -->
          </el-select>
        </el-form-item>
        <!-- 调整标签选择器 -->
        <el-form-item label="Adjustments Tags">
          <el-select v-model="form.adjustmentsTags" placeholder="请选择">
            <!-- 这里添加选项 -->
          </el-select>
        </el-form-item>
        
        <el-form-item>
          <el-button @click="cancel">取消</el-button>
          <el-button type="primary" @click="save">保存</el-button>
        </el-form-item>
    </el-col>

    </el-row>
    <ul>
      <li v-for="file in fileList" :key="file.name">{{ file.name }}</li>
    </ul>

  </el-form>
</div>
</template>

<script>
import axios from 'axios';
import { mapState } from 'vuex';

export default {
  name: "SetScenario",
  data() {
    return {
      form: {
        modelName: '', // 模型名称
        productionCalculation: true, // 生产演算开关
        residentialVacancyRate: 0.21, // 住宅空置率
        householdGrowthRate: 0.21, // 家庭增长率
        selectedJobControl:null,
        selectedHControl:null,
        selectedCollection:null,
        // 其他表单项的数据模型...
      },
      modelNames:[
        {label: "NOTDM", value: "NOTDM"},
        {label: "BaseLine", value: "BaseLine"}
        
      ],
      travelModelZones:[
        {label: "Travel Zones", value: "Travel Zones"},
        {label: "Travel Parcels", value: "Travel Parcels"}
      ],
      fileList: [],
    };
  },
  methods: {
    handleSuccess(response, file) {
            console.log('文件上传成功！', file);
        },
    handleError(err, file) {
            console.log('文件上传错误！', err, file);
        },

    save() {
      console.log(this.form);
      axios.post('http://localhost:5000/set/setsenario', this.form)
          .then(response => {
              // 处理响应
              this.status = response.data.status; 
              console.log(this.status);
          })
          .catch(error => {
              // Handle any errors here
              console.error('Error:', error);
          });
        },
    cancel() {
      // 在这里添加取消表单编辑的逻辑
      console.log('Form reset');
      this.$refs.form.resetFields();
    }
  },
  computed: {
    // 从 Vuex 获取并过滤出 job_controls 相关的数据
    jobControlsOptions() {
      // 找到包含 '就业控制总量' 的对象
      const jobControlsData = this.$store.state.elTreeData.find(
        data => data.label === '就业控制总量'
      );
      // 确保找到该对象并且该对象有 children 属性
      return jobControlsData && jobControlsData.children
        ? jobControlsData.children
        : [];
    },
    HControlsOptions() {
      // 找到包含 '就业控制总量' 的对象
      const HControlsData = this.$store.state.elTreeData.find(
        data => data.label === '家庭控制总量'
      );
      // 确保找到该对象并且该对象有 children 属性
      return HControlsData && HControlsData.children
        ? HControlsData.children
        : [];
    },
    ...mapState(['baseDataCollections']), // 在computed中引入baseDataCollections
  },
  mounted(){
    console.log("🚀 ~ mounted ~ baseDataCollections:", this.baseDataCollections)
  }
}
</script>

<style scoped>
.scenario-container {
  width: 100%; /* 这将使容器宽度为100% */
}

.el-form-item {
  margin-bottom: 16px; /* 表单项间距 */
}

/* 如果你有任何全局样式限制了最外层容器的宽度，也需要进行修改。 */
</style>